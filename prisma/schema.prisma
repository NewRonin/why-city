generator client {
  provider      = "prisma-client"
  output        = "generated"
  moduleFormat  = "esm"
  binaryTargets = ["native", "windows", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Point {
  id               Int      @id @default(autoincrement())
  title            String
  address          String   @db.Text
  latitude         Float
  longitude        Float
  taskType         TaskType
  taskText         String   @db.Text
  filePath         String?
  fileSize         Int?
  mimeType         String?
  correctAnswer    String
  successMessage   String   @db.Text
  order            Int?

  route            Route?   @relation(fields: [routeId], references: [id])
  routeId          Int?

  attempts         Attempt[]
}

model Route {
  id               Int      @id @default(autoincrement())
  routeNumber      String
  points           Point[]
  teams            Team[]
}

model Team {
  id               Int      @id @default(autoincrement())
  name             String
  password         String   @unique
  route            Route    @relation(fields: [routeId], references: [id])
  routeId          Int
  currentPoint     Int
  score            Int      @default(0)
  startTime        DateTime?
  finishTime       DateTime?  

  attempts         Attempt[]
}

model Admin {
  id        Int     @id @default(autoincrement())
  username  String  @unique
  password  String
}

model Attempt {
  id        Int      @id @default(autoincrement())
  teamId    Int
  pointId   Int
  attempts  Int      @default(0)
  updatedAt DateTime @updatedAt

  team      Team     @relation(fields: [teamId], references: [id])
  point     Point    @relation(fields: [pointId], references: [id])

  @@unique([teamId, pointId])
}

model ModulesAccess {
  id        Int     @id @default(autoincrement())
  pageName  String  @unique
  isEnabled Boolean @default(true)
}

enum TaskType {
  text
  image
  audio
}

